WindowManager:
    MainWindow:
    SecondWindow:

<P>:
    name:"popup_layout"
    Label:
        text: "Please make sure that the door is closed!"
        size_hint: 0.6, 0.2
        pos_hint: {"x":0.2, "top":1}
        color: 0.1,0.1,0.1,1

    Button:
        text: "OK"
        size_hint: 0.8, 0.2
        pos_hint: {"x":0.1, "y":0.1}
        on_release: root.parent.parent.parent.dismiss()

<Button>:
    font_size: 40
    color: 0.1,0.1,0.1,1
    size_hint: 0.3,0.2
    background_color: (0, 2, 2, 0.5)

<FloatLayout>:
    canvas.before:
        Color:
            rgba: 1, 1, 1, 1
        Rectangle:
            # self here refers to the widget i.e BoxLayout
            pos: self.pos
            size: self.size

<MainWindow>:
    name: "main"
    background_color: (0.0, 0.0, 1.0, 1)

    FloatLayout:

        Label:
            pos_hint:{"top":1.05}
            color: 0.1,0.1,0.1,1
            text: "Please hold the button and pull the door to open the recycle box :)"

        Button:
            id: unlock_btn
            text: "UNLOCK" if unlock_btn.state == "normal" else "Pull the door"
            pos_hint: {"x":0.35, "top":0.8}

        Label:
            pos_hint:{"top":0.75}
            color: 0.1,0.1,0.1,1
            text: "Click the button to get your voucher code!"

        Button:
            id: confirm_btn
            text: "CONFIRM"
            pos_hint: {"x":0.35, "top":0.5}
            on_release:
                root.update_status()
                if not root.door_locked: root.trigger_popup()
                if root.door_locked: app.root.current = "second"
                if root.door_locked: root.manager.transition.direction = "left"

        Image:
            source: root.image1
            size_hint: 0.4,0.2
            pos_hint: {"bottom":0, "right":1}

        Image:
            source: root.image2
            size_hint: 0.2,0.2
            pos_hint: {"top":0.95, "x":0.05}
            background_color: (1.0, 1.0, 1.0, 1)


<SecondWindow>:
    name: "second"
    on_pre_enter:
        # In order to get the bottle number again when the entering the second window again
        root.for_on_pre_enter()
        btn.text = root.button_text
        label.text = root.label_text
        qr_image.source = root.image1

    FloatLayout:
        Label:
            id: label
            size_hint: 0.8, 0.2
            pos_hint:{"x": 0.1, "y":0.25}
            valign: 'middle'
            color: 0.1,0.1,0.1,1
            text: root.label_text

        Button:
            id: btn
            text: root.button_text
            pos_hint: {"x":0.35, "y":0.1}
            on_release:

                if root.state == 1:    btn.text = "CONFIRM"
                if root.state == 1:    qr_image.source = root.image1
                if root.state == 1:    app.root.current = "main"

                if root.state == 0:    qr_image.source = root.show_qr()
                if root.state == 0:    btn.text = "FINISH"
                if root.state == 0:    root.state_increase()


        Image:
            id: qr_image
            size_hint: 0.5,0.5
            pos_hint: {"y":0.4, "x":0.25}
            background_color: (1.0, 1.0, 1.0, 1)
